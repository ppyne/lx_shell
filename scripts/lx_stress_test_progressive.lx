print("LX progressive stress test begin", LX_EOL);

function sieve_stats($N) {
    $prime = [];
    for ($i = 0; $i <= $N; $i++) { $prime[$i] = 1; }
    $prime[0] = 0;
    $prime[1] = 0;
    for ($p = 2; $p * $p <= $N; $p++) {
        if ($prime[$p]) {
            for ($k = $p * $p; $k <= $N; $k += $p) {
                $prime[$k] = 0;
            }
        }
    }
    $sum = 0;
    $count = 0;
    for ($i = 2; $i <= $N; $i++) {
        if ($prime[$i]) {
            $count = $count + 1;
            $sum = $sum + $i;
        }
    }
    return [$count, $sum];
}

function mat_checksum($size) {
    $a = [];
    $b = [];
    for ($i = 0; $i < $size; $i++) {
        $a[$i] = [];
        $b[$i] = [];
        for ($j = 0; $j < $size; $j++) {
            $a[$i][$j] = ($i * 3 + $j * 7 + 1) % 97;
            $b[$i][$j] = ($i * 5 + $j * 11 + 2) % 89;
        }
    }
    $checksum = 0;
    for ($i = 0; $i < $size; $i++) {
        for ($j = 0; $j < $size; $j++) {
            $acc = 0;
            for ($k = 0; $k < $size; $k++) {
                $acc = $acc + ($a[$i][$k] * $b[$k][$j]);
            }
            $checksum = $checksum + $acc;
        }
    }
    return $checksum;
}

function mix($x, $iters) {
    $v = $x;
    for ($i = 0; $i < $iters; $i++) {
        $v = ($v * 33 + $i) % 65521;
    }
    return $v;
}

$steps = [
    ["N" => 2000, "M" => 20, "K" => 500],
    ["N" => 4000, "M" => 25, "K" => 800],
    ["N" => 6000, "M" => 30, "K" => 1000],
    ["N" => 8000, "M" => 35, "K" => 1500],
    ["N" => 10000, "M" => 40, "K" => 2000],
    ["N" => 12000, "M" => 45, "K" => 2500]
];

for ($i = 0; $i < count($steps); $i++) {
    $step = $steps[$i];
    $N = $step["N"];
    $M = $step["M"];
    $K = $step["K"];
    print("--- step ", $i + 1, " N=", $N, " M=", $M, " K=", $K, LX_EOL);

    $s = sieve_stats($N);
    print("primes: ", $s[0], " sum=", $s[1], LX_EOL);

    $chk = mat_checksum($M);
    print("matrix ", $M, "x", $M, " checksum=", $chk, LX_EOL);

    $m = mix(12345, $K);
    print("mix iters=", $K, " value=", $m, LX_EOL);
}

print("LX progressive stress test end", LX_EOL);
